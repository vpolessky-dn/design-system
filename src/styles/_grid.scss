@use 'sass:map';
@use 'sass:math';

// max columns
$columns: 12;
// max rows
$rows: 8;

$gutter: 16px;
$margin-y: 16px;
$margin-x: 20px;

$grid-hd: (
	gutter: $gutter,
	margin: $margin-y $margin-x,
);

:root {
	--grid-gutter: #{$gutter};
	--grid-margin: #{$margin-x};
	--grid-columns: #{$columns};

	// Computed width of a single grid column: (viewport_width - margins - gutters) / number_of_columns
	--grid-column-size: calc(
		((100vw - 2 * var(--grid-margin)) - ((var(--grid-columns) - 1) * var(--grid-gutter))) /
			var(--grid-columns)
	);

	// Generate custom properties for each column span (1 through 12)
	// Each --col-span-N represents the total width for spanning N columns
	@for $i from 1 through $columns {
		// Margins are added to all column spans to ensure proper alignment
		// The last column span (full width) receives 2 margins (left + right), others receive 1 margin (typically left)
		$margins: if($i == $columns, 2, 1);

		// Calculate total width for spanning i columns:
		// - i columns Ã— column width
		// - (i-1) gutters between columns
		// - appropriate margins (1 or 2 depending on if it's full width)
		--col-span-#{$i}: calc(
			#{$i} * var(--grid-column-size) + #{($i - 1)} * var(--grid-gutter) + var(--grid-margin) * #{$margins}
		);
	}
}

@mixin grid-setup($grid-setup) {
	gap: map.get($grid-setup, 'gutter');
	padding: map.get($grid-setup, 'margin');
	width: 100%;
	height: 100%;
	box-sizing: border-box;
}

@mixin generate-grid-classes($grid-setup) {
	@for $i from 1 through $columns {
		.ds-grid-col-span-#{$i} {
			--col-span: #{$i};
		}
		@if $i < $columns {
			.ds-grid-col-start-#{$i} {
				--col-start: #{$i};
			}
		}
	}
	@for $i from 1 through $rows {
		.ds-grid-row-span-#{$i} {
			--row-span: #{$i};
		}
		@if $i < $rows {
			.ds-grid-row-start-#{$i} {
				--row-start: #{$i};
			}
		}
	}
	@for $i from 3 through $columns {
		&.ds-grid-cols-#{$i} {
			grid-template-columns: repeat($i, 1fr);
		}
	}
	@for $i from 1 through math.floor(calc($rows / 2)) {
		$row-count: 2 * $i;
		&.ds-grid-rows-#{$row-count} {
			grid-template-rows: repeat($row-count, 1fr);
		}
	}
	.ds-grid-col-span-full {
		--col-span: #{$columns};
	}
	.ds-grid-row-span-full {
		--row-span: #{$rows};
	}
}

.ds-grid {
	display: grid;
	grid-template-columns: repeat($columns, 1fr);
	grid-template-rows: 1fr;
	@include grid-setup($grid-hd);
	@include generate-grid-classes($grid-hd);

	/*
    @media screen and (min-width: $qhd) {
      @include grid-setup($grid-qhd);
    }
  */
}

.ds-grid > [class^='ds-grid'] {
	grid-column: var(--col-start, auto) / span var(--col-span, 1);
	grid-row: var(--row-start, auto) / span var(--row-span, 1);
}
